---
title: The BioDT Recreational Potential Model
subtitle: Summary
authors:
  - name: Joe Marsh Rossney
    orcid: 0000-0002-8082-8566
    affiliation: UK Centre for Ecology & Hydrology
  - name: Maddalena Tigli
    orcid: 0000-0001-8083-0589
  - name: Chris Andrews
  - name: Jan Dick
  - name: Simon Rolph

date: today
date-format: long
abstract: >
  These documents collectively describe the xyz.

citation: true
license: CC BY
funding: This work was funded by BioDT
---

## Background

TODO Brief history of recreational potential work, with references

ESTIMAP (“Ecosystem Service Mapping Tool”) is a collection of spatially explicit models, originally developed to support policies at a European scale [@Zulian2013; @Paracchini2014;  @Zulian2018].

[OpenNESS project](https://oppla.eu/groups/openness/openness-project) 2012-2017 [@Zulian2018]. (note www.openness-project.eu has been abandoned)

Something something _Long Term Socio-Ecological Research Platforms_ (LTSER) [@Dick2018]

BioDT project 2022-2025, outputs include [@Rolph2024; @Dick2025b]. 

SPEAK has something to do with Powell2024 ?

TODO Brief introduction to BioDT, the CES project and the recreational potential component. [@Dick2022; @Rolph2024]


The BioDT consortium ... 
As a member of this
Cultural Ecosystem Services (CES) 
Digital Twin (DT).

The CES DT was imagined as a platform that brings together near real time data from a wide range of sources in a manner that is somehow tailored to the individual user. The proposed pDT focuses on two components:

1. The **Recreational Potential (RP)** component aims to estimate the capacity of a given area to sustain the recreational activities valued by an individual user.
2. The **Biodiversity** aims to predict biodiversity levels ==(abundance?)== across mammals, birds, plant and insects.

The rationale behind bringing these two components together into a unified framework is that encountering interesting flora or fauna can enrich people's recreational experiences, and help them to discover new ways to value nature-rich landscapes.

The driving motivation for this work is to promote good health and connection to nature through physical activity outdoors. However, there is also a possible synergy with conservation science, which is increasingly using data collected by non-scientists through 'citizen science' apps such as [iNaturalist](https://www.inaturalist.org/) and [iRecord](https://www.brc.ac.uk/recording). Potentially, certain users could be encouraged to visit areas where there is a greater need for sampling, (see also [DECIDE](https://www.ceh.ac.uk/our-science/projects/decide) project ==citation?==).

The RP component and the biodiversity component are distinct models that have been developed independently of each other. However, in both cases their outputs can be displayed on an interactive map of Scotland and served to users using an app framework such as R Shiny [@Shiny2025].

Earlier on in the BioDT project, rudimentary versions of the RP and biodiversity components were combined in a single raster overlay. However, this was limited to pre-calculated 'static' raster layers covering a small region (the Cairngorms National Park) rather than all of Scotland [@Rolph2024]. Since then, work has focused on improving the speed and scalability of these components, to enable the interactive and personalisable experience that was envisaged.

In this short report we will describe basic aspects of the Recreational Potential model. For a detailed account of the inner workings of the model the reader is directed to the accompanying [technical supplement](tech_supp.html). The Biodiversity component is described in ==TODO: ref==.

## Model description

### Overview

To describe the Recreational Potential model we will start from its outputs and work backwards.

The main model output is an two-dimensional array of numbers (a _raster_) representing an *RP value* between $0$ and $1$ for each 20x20 metre square area of land (_pixel_) within a given area, with higher values indicating greater Recreational Potential for that specific persona. These RP values can then be mapped to colours and displayed as a _heat map_ over a map of Scotland, as illustrated in @fig-rpexample.

![An example of a heat map displaying Recreational Potential.](images/rp_example.png){#fig-rpexample}

An RP value is constructed from a combination of **87** _items_ representing distinct attributes of the land. The 87 items are grouped into four _components_:

- **_Landscape_** - the suitability of land to support recreational activity (40 items).
- **_Natural Features_** influencing the potential (24 items).
- **_Infrastructure_** features influencing the potential (10 items).
- **_Water_** - rivers and lakes (13 items).

RP values are calculated by weighting each item by a _score_ between $0$ and $10$ that reflects the importance of that item to the user. A full set of 87 scores is referred to as a _persona._

The RP model thus requires two inputs from users:

1. A **persona**, i.e. the 87 scores for each item/feature, contained in a `.csv` file.
2. A **region of interest**, i.e. an area within Scotland in which to calculate RP values, given by either a shapefile or the four coordinates of a bounding box.

We will often refer to the computations that produce an RP raster from the two user inputs as the 'dynamic' part of the RP model, since these computations must be performed each time the user makes a change to their persona or region of interest. The dynamic part is outlined in @fig-mermaid.

```{mermaid}
%%| label: fig-mermaid
%%| fig-cap: A breakdown of the 'dynamic' part of the Recreational Potential model, that responds to changes in user input.

flowchart LR
 subgraph s1["compute recreational potential"]
        C[("cropping of the 4<br>components file to the<br>extent of interest")]
        E["Compute each component's<br>contribution"]
        F["Rescale to unit interval"]
  end
    A("Definition of the<br><i>persona preferences</i>") ---> E
    B("Definition of the<br><i>area of interest</i>") --> C
    C --> E
    E --> F
    F --> G["recreational potential spatRast"]
    style s1 fill:#FFF9C4
    style A color:#000000
    style B color:#000000
    style C color:#000000
    style E color:#000000
    style F color:#000000
    style G color:#000000
```


### Persona

As previously stated, a persona is nothing more than a set of 87 numbers between $0$ and $10$ corresponding to each of the 87 items.

Personas are stored in `.csv` files. However, the interactive R Shiny app provided with the model (@sec-shinyapp) contains a convenient interface for loading, saving and editing personas. @fig-persona is a screenshot from this app, showing some example persona scores for the _Water_ component.

![An example set of persona scores for the 'Water' component.](images/persona.png){#fig-persona}


### Input data

There is another essential set of inputs to the model which are not specified by the user. These are a set of 87 raster layers --- one for each of the 87 items --- covering Scotland at a resolution of 20x20m.

For items belonging to the *Landscape* (`SLSRA`) component or the *Natural Features* component (`FIPS_N`), these rasters contain just ones and zeros, with $1$ indicating presence of the feature in that pixel and $0$ indicating absence.

$$
\mathrm{SLSRA}_j = \begin{cases}
1 & \text{if feature} \; j \; \text{present in pixel} \\
0 & \text{if feature} \; j \; \text{absent in pixel} 
\end{cases}
$$

==TODO: screenshot of one of these layers==

For items belonging to the _Infrastructure_ (`FIPS_I`) component or the _Water_ (`Water`) component, the input rasters contain values _between_ zero and one.

$$
\mathrm{Water}_j = \begin{cases}
1 & \text{if feature} \; j \; \text{present in pixel} \\
0 & \text{if feature} \; j \;\gtrapprox 500\text{m away} \\
u(\mathrm{distance}_j) & \text{otherwise}
\end{cases}
$$

where $\mathrm{distance}_j$ is the distance to the nearest pixel in which the feature $j$ is present, and $u(d)$ is a function that takes distances $d$ as input, and outputs values between $0$ and $1$, decreasing as $d$ increases, and falling to zero at a distance of approximately 500m (see Eq. (==X==) in the Technical Supplement for details). 

==TODO: screenshot of  a layer with/without the proximity part==

Thus, $1$ still indicates presence of the feature in that pixel, but $0$ instead indicates that the feature is not only absent in that pixel, but all surrounding pixels within 500m. The range of values between zero and one are used to signify that the feature is nearby (within 500m), but not present in this pixel itself.

This continuous scale allows the RP model to incorporate how areas near e.g., a loch, can still contribute to the recreational potential, even if they do not directly contain the feature.

### Recreational Potential calculation

Each of the four components is calculated by multiplying the item/features by the corresponding persona score, summing, and normalising the result,

$$
\mathrm{SLSRA} = \mathrm{normalise}\left( \sum_j \mathrm{Score}^{(\text{SLSRA})}_j \times \mathrm{SLSRA}_j \right) \, .
$$

In this context, 'normalisation' means transforming the values so that they lie between $0$ and $1$, through the following transformation:

$$
\mathrm{normalise}(x) = \frac{x - x_\text{min}}{x_\text{max} - x_\text{min}} \, .
$$

The final RP value is calculated by summing these four components and normalising once more,

$$
\mathrm{RP} = \mathrm{normalise} \left( \mathrm{SLSRA} + \mathrm{FIPS\_N} + \mathrm{FIPS\_I} + \mathrm{Water} \right) \, .
$$


## Model code

### Brief history of development work

The RP model for Scotland has been gradually developed within UKCEH over a number of years, with various contributors.

- ==TODO early history. Originally copied from someone else's python model?==
- TODO When was the calibration etc done?
- Add SPEAK study


| Time period   | Activity         | References                                                                                                                                                       |
| ------------- | ---------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 2023          | Code development | https://github.com/BioDT/uc-ces/tree/main/recreation_model                                                                                                       |
| 2024          |                  | https://github.com/BioDT/uc-ces-recreation/tree/2024-model                                                                                                       |
| Jan-June 2025 |                  | Version used in SPEAK study: https://github.com/BioDT/uc-ces-recreation/tree/SPEAK-prerelease<br>Development version: https://github.com/BioDT/uc-ces-recreation |

: History of development for the Recreational Potential model. {#tbl-history}

### Overview of the repository

Source code for the most recent version of the RP model can be found on GitHub at https://github.com/BioDT/uc-ces-recreation. This may be more up-to-date than the version of the code published on Zenodo.

The repository is organised in the following way:

```txt
├── CONTRIBUTING.md  # <1>
├── DESCRIPTION  # <2>
├── inst
│   ├── examples
│   │   ├── capture_messages.R # <3>
│   │   ├── compute_component.R
|   |   ...
│   │   └── save_persona.R  # <3>
│   ├── extdata
│   │   ├── config
│   │   │   └── config.csv  # <4>
│   │   ├── personas
│   │   │   └── presets.csv  # <5>
│   │   ├── rasters
│   │   │   ├── Bush
│   │   │   │   ├── FIPS_I.tif  # <6>
│   │   │   │   ├── FIPS_N.tif
│   │   │   │   ├── SLSRA.tif
│   │   │   │   └── Water.tif   # <6>
│   │   │   └── Scotland
│   │   │       ├── FIPS_I.tif  # <7>
│   │   │       ├── FIPS_N.tif
│   │   │       ├── SLSRA.tif
│   │   │       └── Water.tif   # <7>
│   │   └── shapefiles
│   │       ├── Bush
│   │       │   ├── Bush.cpg  # <8>
│   │       │   ├── Bush.dbf
│   │       │   ├── Bush.prj
│   │       │   ├── Bush.shp
│   │       │   └── Bush.shx  # <8>
│   │       └── Scotland
│   │           ├── Scotland.cpg  # <9>
│   │           ├── Scotland.dbf
│   │           ├── Scotland.prj
│   │           ├── Scotland.shp
│   │           └── Scotland.shx  # <9>
│   └── scripts
│       ├── cli
│       │   ├── app.sif  # <10>
│       │   ├── main.R  # <11>
│       │   └── README.md
│       └── data_production
│           ├── app.sif  # <12>
│           ├── main.R  # <13>
│           └── README.md
├── LICENSE  # <14>
├── LICENSE.md  # <14>
├── man
│   ├── assert_to_bool.Rd  # <15>
│   ├── assert_valid_bbox.Rd
│   ...
│   └── timed.Rd  # <15>
├── NAMESPACE  # <16>
├── R
│   ├── app_run.R         # <17>
│   ├── app_server.R
│   ├── app_text.R
│   ├── app_theme.R
│   ├── app_ui.R
│   ├── bbox.R
│   ├── config.R
│   ├── data_download.R
│   ├── data_input.R
│   ├── data_production.R
│   ├── example.R
│   ├── legacy.R
│   ├── persona.R
│   ├── recreation.R
│   └── utils.R           # <17>
├── README.md
├── renv.lock  # <18>
├── dev
│   ├── cli_test.sh  # <19>
│   ├── dev.sh  # <20>
│   ├── pre-commit.R  # <21>
│   ├── README.md
│   └── run_app.sh  # <22>
├── tests
│   └── testthat
│       └── test_io.R  # <23>
└── vignettes
    ├── compute_potential.qmd  # <24>
    ├── personas.qmd
    └── run_app.qmd  # <24>
```

1. Instructions for potential contributors.
2. The standard [`DESCRIPTION` file](https://r-pkgs.org/description.html) for R packages, containing metadata about the package.
3. Simple examples using the package functions, which get included in the generated documentation.
4. Configuration file, mapping layer names to raster values (for the pre-processing step) and descriptions (used in the Shiny app).
5. File containing two 'preset' personas: the 'hard' and 'soft' recreationalists described in @Rolph2024.
6. Dataset covering a small area, for use in examples and vignettes.
7. Dataset for all of Scotland. This is not included in the package and is instead downloaded separately.
8. Shapefile and auxiliary data for the example dataset.
9. Shapefile and auxiliary data for the full Scotland-wide dataset.
10. Container definition file used to build a Singularity container for `cli/main.R`.
11. Command-line script for the model taking a persona and bounding box as input. This is expected to be called from the main BioDT app.
12. Container definition file used to build a Singularity container for `data_production/main.R`.
13. Script that executes all steps of the data pre-processing pipeline.
14. MIT licenses (`.md` for the repository, no extension for the package).
15. Compiled documentation for the package, generated using [roxygen2](https://roxygen2.r-lib.org/).
16. The standard [`NAMESPACE`](https://r-pkgs.org/namespace.html) file for R packages, containing a list of functions provided by the package.
17. Source code for the package.
18. [`renv`](https://rstudio.github.io/renv/) lockfile used (in theory) to install packages deterministically. Used when deploying app to Posit Connect.
19. Bash script that runs `Rscript inst/scripts/cli/main.R` with example data.
20. Bash script that runs `pre-commit` if available, or else `Rscript scripts/pre-commit.R`, as well as the tests.
21. R script that emulates the behaviour of `pre-commit` when run, in case the latter is not installed.
22. Bash script that loads the local version of the package and runs the Shiny app, for convenience during development.
23. A file containing [unit tests](https://testthat.r-lib.org/). Essentially tokenistic, but provides a template for more unit tests to be added in future.
24. Some [vignettes](https://r-pkgs.org/vignettes.html) demonstrating simple use of the package.

:::{.callout-note}
#### A note on the `inst/` directory

Apparently it has become standard practice to use the `inst/` directory to distribute additional elements such as scripts and Shiny apps along with the package. This is the practice we have adopted here. There are really just two important things to know about the `inst/` directory:

First, that its contents are copied to the top-level of the package when the package is built. Hence, the top level of the built package will contain `examples/`, `extdata/` and `scripts/` (the directory containing shell scripts is not included in the package).

Hence, in order for file paths to work when the package is installed, one must omit `inst/` from the path. But this means the path will not work during development.

The way to regain consistency between the two situations (installed versus not installed) is to use[`system.file`](https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/system.file). There are several examples of this in the code, including the one below, where paths to files or directories under `inst/` needed to be constructed.

```R
get_preset_persona_file <- function() {
    system.file("extdata", "personas", "presets.csv",
        package = "biodt.recreation", mustWork = TRUE
    )
}
```
:::

### Package contents

The code is bundled as an `R` _package_. This has a number of advantages compared with a stand-alone script, since the standardised setup allows us to leverage tools for _installing_, _documenting_ and _testing_ the code, and managing its dependencies on other packages.

In particular, the package may be installed by passing the GitHub repository to [`remotes::install_github`](https://remotes.r-lib.org/reference/install_github.html) (or the `devtools` function with the same name).

```R
remotes::install_github("BioDT/uc-ces-recreation")
```

In practical terms, this means the functionality is provided through a collection of _functions_ in the `R/` directory that, after installing the package, are accessible to the user in the `biodt.recreation` namespace. That is, functions such as `compute_potential` are accessed using the syntax `biodt.function::compute_potential`, or by name alone after exposing the whole namespacing using `library(biodt.recreation)`.

Documentation for these functions is contained in the `.Rd` files within the `man/` directory. This documentation can be brought up in RStudio.

==TODO: screenshot of documentation==

### Production of input data

The 'raw' data is downloaded from various locations (TODO - Chris).
There is then a series of processing steps to transform it into the form needed for the RP model.

In an ideal world this data production 'pipeline' would be entirely automated through one or more scripts. This would enable the input data to be more easily regenerated / updated in future.


This data is currently stored on DropBox, but will be moved to Zenodo.

2. Download the data:

```R
biodt.recreation::download_data()
```


### Interactive Shiny app {#sec-shinyapp}

- TODO: how to run it locally

```R
biodt.recreation::run_app()
```

However, the essential steps are: (i) create a persona using the 'Persona' tab, (ii) draw a box on the map using the square orange button, and finally (iii) click the 'Update Map' button to compute the Recreational Potential value.


## Worked example

<!-- {{< include demo.qmd >}} -->

We demonstrate the RP Model applied to the Bush Estate area (nearby Edinburgh) using two contrasting personas:

1. **_Hard Recreationalist_**: this persona values remote, challenging environments and avoids built-up or highly managed areas.
2. **_Soft Recreationalist_**: this persona values tranquil, accessible landscapes and natural water features, and avoids steep or harsh terrain.

==TODO: when/how where these personas created?==
These personas are provided in the model as 'presets'; users may customise them or simply use them out-of-the-box.

The resulting maps illustrate how different preferences lead to different areas being highlighted for recreational value.

The source code used to produce these maps can be found in the [demo notebook](demo.html).

```{r, echo=FALSE}
library(magrittr)
library(biodt.recreation)

source("functions_report.R")

water <- terra::rast(system.file("extdata", "rasters", "Bush", "original", "Water.tif", package="biodt.recreation"))

slsra <- terra::rast(system.file("extdata", "rasters", "Bush", "SLSRA.tif", package="biodt.recreation"))

fips_n <- terra::rast(system.file("extdata", "rasters", "Bush", "FIPS_N.tif", package="biodt.recreation"))

fips_i <- terra::rast(system.file("extdata", "rasters", "Bush", "original", "FIPS_I.tif", package="biodt.recreation"))



# the box of bush estate
e <- terra::ext(water)
coords <- matrix(c(
  e$xmin, e$ymin,
  e$xmax, e$ymin,
  e$xmax, e$ymax,
  e$xmin, e$ymax,
  e$xmin, e$ymin # close polygon
), ncol = 2, byrow = TRUE)
bbox_poly <- terra::vect(coords,
  type = "polygons",
  crs = terra::crs(water)
) %>%
  sf::st_as_sf() %>%
  sf::st_transform(crs = 4326)

base_map <- 
  leaflet::leaflet() %>%
  leaflet::addProviderTiles("OpenStreetMap.Mapnik", options = leaflet::providerTileOptions(zIndex = 0, noWrap = TRUE), group = "Streets") %>%
  leaflet::addProviderTiles("Esri.WorldImagery", options = leaflet::providerTileOptions(zIndex = 0, noWrap = TRUE), group = "Satellite") %>%
  leaflet::addPolygons(
    data = bbox_poly,
    color = "black",
    weight = 3,
    fill = FALSE
  ) 

```

### Hard Recreationalist

The strongest preferences of the *Hard Recreationalist* persona are highlighted in ==TABLE==

```{r, echo=FALSE, message=FALSE}

hard_recr <- 
  data.frame(get_example_persona())%>%
  tibble::rownames_to_column(var = "Name")%>%
  dplyr::select(Name,
                Score = `get_example_persona..`)

meaningful_scores <- summarise_persona_scores(hard_recr)
  
knitr::kable(meaningful_scores,format = "html",
             caption = "Features scored the highest and the lowest in the hard recreationalist persona")
```



```{r, echo=FALSE, warning=FALSE, results='hide', message = FALSE}
hard_recreationalist <- get_example_persona()
bush_estate <- get_example_bbox()
data_dir <- get_example_data_dir()

# Compute all layers
layers_HR <- compute_potential(hard_recreationalist,
                            bush_estate,
                            data_dir)
```

```{r, echo=FALSE }
build_rp_map(base_map, RP_output = layers_HR)
```

### Soft Recreationalist

The strongest preferences of the *Soft Recreationalist* persona are highlighted in ==TABLE==

```{r, echo=FALSE}

soft_recr <- 
  read.csv(system.file("extdata", "personas", "presets.csv", package="biodt.recreation")) %>%
  dplyr::select(Name = index,
                Score = Soft_Recreationalist)

meaningful_scores <- summarise_persona_scores(soft_recr)
  
knitr::kable(meaningful_scores,format = "html",
             caption = "Features scored the highest and the lowest in the soft recreationalist persona")
```


```{r, echo=FALSE, warning=FALSE, results='hide', message = FALSE}
soft_recreationalist <- 
  load_persona(get_preset_persona_file(), "Soft_Recreationalist")
  
# Compute all layers
layers_SR <- compute_potential(soft_recreationalist,
                            bush_estate,
                            data_dir)
```

```{r, echo=FALSE}
build_rp_map(base_map, RP_output = layers_SR)
```


## Discussion & next steps

- The model is very fast and embarrassingly parallel - therefore can scale very well, to large areas and/or high resolutions.
- However, the use-case for large areas is unclear, and the resolution depends on the datasets being used.

- The data production pipeline could be improved:
	- Fully automated / scripted would allow easier updating with more / updated datasets
	- Also reproducibility and transparency of how the data was produced (many users wanted to know more about the input data)

 - Use of rasters is a problem for linear features
	 - Use vector layers for linear features and distance
	 - This would also make data production easier

- Digital twin?


## Conclusions


## Funding {.appendix}

Funding for OpenNESS came from the European Community's Seventh Framework Programme (FP7/2007-2013) under grant agreement no 308428, OpenNESS Project (Operationalisation of Natural Capital and Ecosystem Services: From Concepts to Real-world Applications.)

Funding for BioDT came from the European Union's Horizon Europe Research and Innovation Programme under grant agreement No 101057437 (BioDT project, [https://doi.org/10.3030/101057437](https://doi.org/10.3030/101057437))

Funding for SPEAK came from the Natural Environment Research Council – Growing Shoots Partnership and application co-creation bursary. NE/Y005805/1 _Growing Shoots​

## CRediT statement {.appendix}

**To do**: https://www.elsevier.com/en-gb/researcher/author/policies-and-guidelines/credit-author-statement

## Acknowledgements {.appendix}

- Will Bolton contributed to the first version of the code.
- Megan Williams?

We are very grateful to all the partipcants of the SPEAK project which this output is based on including: Alastair Leaver, Alice MacSporran, Brian Cassidy, Chris Pollock, David Giles, Jean Cowie, Joanna Gilliatt, Justyna Olszewska, Laura Taylor, Maddi Bunker, Rebecca MacLennan, S Mayes, Shaila Rao, Steve MacKinnon and Tom Gebbie, Active Stirling. We are equally grateful to an additional 18 partipcants who preferred to remain anonymous. ​


## Correspondence {.appendix}

- `{jand,chan}@ceh.ac.uk` for enquiries related to the BioDT or SPEAK projects, or ongoing and future work.

- `chan@ceh.ac.uk` for enquiries related to the production of input data using QGIS.

- `{joemar,madtig}@ceh.ac.uk` for enquiries related to the code and anything else appearing in the technical supplement and/or developer's report.

​